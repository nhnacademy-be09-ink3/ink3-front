<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ink3</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/output.css}">
</head>
<body class="bg-gray-100">
<div th:replace="~{layout/fragments/header :: headerFragment}"></div>

<main class="px-6 py-8 bg-gray-100">
    <span class="hidden force-include"></span>
    <div class="flex max-w-7xl mx-auto gap-6">
<!--         ğŸ”½ ì¢Œì¸¡ ì¹´í…Œê³ ë¦¬-->
<!--         ì¹´í…Œê³ ë¦¬ ì‚¬ì´ë“œ ë©”ë‰´ (ë‹¤ë‹¨ êµ¬ì¡°)-->
        <aside class="w-40 self-start bg-white rounded-lg shadow p-4 relative overflow-visible">
            <h2 class="text-lg font-bold mb-4">ğŸ“š ì¹´í…Œê³ ë¦¬</h2>
            <ul class="space-y-2">
                <li class="relative group inline-block">
                    <button type="button" class="text-left font-medium text-gray-700 hover:text-ink-primary transition-colors cursor-pointer">
                        ì†Œì„¤
                    </button>

                    <!-- 2ì°¨ ë©”ë‰´ -->
                    <ul class="absolute top-0 left-full ml-2 invisible opacity-0 flex flex-col pointer-events-none group-hover:visible group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity delay-75 duration-200 bg-white shadow-md rounded px-1 py-1 w-max whitespace-nowrap z-50">

                        <!-- í•œêµ­ ì†Œì„¤ -->
                        <li class="relative group/korea inline-block">
                            <button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary cursor-pointer">
                                í•œêµ­ ì†Œì„¤
                            </button>
                            <ul class="absolute top-0 left-full ml-2 invisible opacity-0 pointer-events-none group-hover/korea:visible group-hover/korea:opacity-100 group-hover/korea:pointer-events-auto transition-opacity delay-150 duration-300 bg-white shadow-md rounded px-1 py-1 w-max whitespace-nowrap z-50">
                                <li><button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary">ê³ ì „ ì†Œì„¤</button></li>
                                <li><button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary">í˜„ëŒ€ ì†Œì„¤</button></li>
                            </ul>
                        </li>

                        <!-- ì™¸êµ­ ì†Œì„¤ -->
                        <li class="relative group/global inline-block">
                            <button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary cursor-pointer">
                                ì™¸êµ­ ì†Œì„¤
                            </button>
                            <ul class="absolute top-0 left-full ml-2 invisible opacity-0 pointer-events-none group-hover/global:visible group-hover/global:opacity-100 group-hover/global:pointer-events-auto transition-opacity delay-150 duration-300 bg-white shadow-md rounded px-1 py-1 w-max whitespace-nowrap z-50">
                                <li><button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary">ê³ ì „ ì†Œì„¤</button></li>
                                <li><button type="button" class="text-left px-2 py-1 text-sm text-gray-700 hover:text-ink-primary">í˜„ëŒ€ ì†Œì„¤</button></li>
                            </ul>
                        </li>

                    </ul>
                </li>
            </ul>
        </aside>

        <!-- ğŸ”¹ ìš°ì¸¡ ë³¸ë¬¸ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ <div>ë¡œ ë¬¶ê¸° -->
        <div class="flex-1">
            <!-- ğŸ“Œ ê²€ìƒ‰ ê²°ê³¼ ì œëª©ê³¼ í‘œì‹œ ê°œìˆ˜ ë‚˜ë€íˆ -->
            <div class="flex justify-between items-center mb-4">
                <h1 id="search-title" class="text-2xl font-bold text-gray-800 truncate max-w-full">
                    ğŸ“š ë„ì„œ ê²€ìƒ‰ ê²°ê³¼
                </h1>
                <div class="flex items-center">
                    <label for="itemsPerPage" class="mr-2 text-sm text-gray-700">í‘œì‹œ ê°œìˆ˜:</label>
                    <select id="itemsPerPage" class="border border-gray-300 rounded px-2 py-1 text-sm">
                        <option value="5">5ê°œ</option>
                        <option value="10" selected>10ê°œ</option>
                        <option value="15">15ê°œ</option>
                        <option value="20">20ê°œ</option>
                        <option value="25">25ê°œ</option>
                    </select>
                </div>
            </div>

            <div id="book-list" class="flex flex-col gap-6 px-4"></div>

            <!-- ì¶”ì²œ ë„ì„œ ì˜ì—­ -->
            <section id="recommended-section" class="py-10 mt-12">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">ğŸ“– ì´ëŸ° ì±…ì€ ì–´ë– ì‹ ê°€ìš”?</h2>
                <div class="max-w-full px-4 py-10">
                    <div id="recommended-books" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 justify-items-center"></div>
                </div>
            </section>
        </div>

    </div>
</main>

<div th:replace="~{layout/fragments/footer :: footerFragment}"></div>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', () => {
        const bookList = document.getElementById('book-list');
        const recommendedBooks = document.getElementById('recommended-books');
        const titleEl = document.getElementById('search-title');
        const itemsPerPageSelect = document.getElementById('itemsPerPage');

        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('q');
        if (query) {
            const maxLength = 10;
            const truncated = query.length > maxLength ? query.slice(0, maxLength) + '....' : query;
            titleEl.textContent = 'ğŸ“š "' + truncated + '" ê²€ìƒ‰ ê²°ê³¼';
        }

        const mockData = Array.from({ length: 1002 }, (_, i) => ({
            id: i + 1,
            title: `ë„ì„œ ì œëª© ${i + 1}`,
            authorNames: [`ì‘ê°€ ${i + 1}`],
            originalPrice: 20000 + i * 100,
            thumbnailUrl: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg"
        }));

        let currentPage = 1;
        let itemsPerPage = parseInt(itemsPerPageSelect.value);

        const renderBooks = () => {
            bookList.innerHTML = '';
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const currentBooks = mockData.slice(start, end);

            currentBooks.forEach(book => {
                const div = document.createElement('div');
                div.className = 'flex bg-white rounded-xl shadow hover:shadow-md w-full max-w-5xl mx-auto transition p-4';

                div.innerHTML = `
            <!-- ë„ì„œ ì´ë¯¸ì§€ -->
            <div class="w-[130px] h-[190px] flex-shrink-0 mr-6">
                <img src="${book.thumbnailUrl}" alt="${book.title}" class="w-full h-full object-cover rounded-md" />
            </div>

            <!-- ë„ì„œ ì •ë³´ì™€ ë²„íŠ¼ ì˜ì—­ -->
            <div class="flex justify-between w-full">
                <!-- ë„ì„œ ì •ë³´ -->
                <div class="flex flex-col justify-between flex-1">
                    <div>
                        <h2 class="text-lg font-bold text-gray-900 mb-1">${book.title}</h2>
                        <p class="text-sm text-gray-600 mb-1">
                            ${book.authorNames.join(', ')} Â· ${book.publisher || 'ì¶œíŒì‚¬'} | ${book.pubDate || 'ì¶œíŒì¼'}
                        </p>
                        <p class="text-base font-semibold text-red-600 mb-1">
                            ${(book.originalPrice * 0.9).toLocaleString()}ì›
                            <span class="text-sm text-gray-400">10% í• ì¸</span>
                        </p>
                        <p class="text-sm text-gray-400 line-through">${book.originalPrice.toLocaleString()}ì›</p>
                        <p class="text-sm mt-2 text-gray-700 line-clamp-2">${book.description || ''}</p>
                    </div>
                </div>

                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex flex-col items-end w-40 flex-shrink-0">
                    <div class="flex items-center justify-between border border-gray-300 rounded px-2 py-1 w-full mb-3">
                        <button onclick="changeQty(${book.id}, -1)" class="text-gray-700 px-2">âˆ’</button>
                        <span id="qty-${book.id}" class="px-2">1</span>
                        <button onclick="changeQty(${book.id}, 1)" class="text-gray-700 px-2">ï¼‹</button>
                    </div>
                    <div class="flex flex-col gap-3 w-full">
                        <button class="ink-btn-primary text-sm px-4 py-2 w-full">ì¹´íŠ¸ì— ë‹´ê¸°</button>
                        <button class="ink-btn-primary text-sm px-4 py-2 w-full mb-2">ë°”ë¡œêµ¬ë§¤</button>
                    </div>
                </div>
            </div>
        `;

                bookList.appendChild(div);
            });
        };
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        const renderPagination = () => {
            let paginationEl = document.getElementById('pagination');
            if (!paginationEl) {
                paginationEl = document.createElement('div');
                paginationEl.id = 'pagination';
                paginationEl.className = 'flex justify-center items-center gap-2 mt-6';
                bookList.after(paginationEl);
            }
            paginationEl.innerHTML = '';

            const totalPages = Math.ceil(mockData.length / itemsPerPage);
            const groupSize = 10;
            const currentGroup = Math.floor((currentPage - 1) / groupSize);
            const startPage = currentGroup * groupSize + 1;
            const endPage = Math.min(startPage + groupSize - 1, totalPages);

            const createBtn = (label, page, isActive = false) => {
                const btn = document.createElement('button');
                btn.textContent = label;
                btn.className = `px-3 py-1 border rounded ${isActive ? 'bg-ink-primary text-white' : 'hover:bg-gray-100'}`;
                btn.disabled = page < 1 || page > totalPages;

                btn.addEventListener('click', () => {
                    currentPage = page;
                    renderBooks();
                    renderPagination();

                    // ğŸ“Œ í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    const scrollTarget = document.getElementById('search-title');
                    if (scrollTarget) {
                        scrollTarget.scrollIntoView({ behavior: 'instant', block: 'start' });
                    }
                });

                return btn;
            };

            // ì´ì „ ê·¸ë£¹ ì´ë™
            if (startPage > 1) {
                paginationEl.appendChild(createBtn('<', startPage - 1));
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationEl.appendChild(createBtn(i, i, i === currentPage));
            }

            // ë‹¤ìŒ ê·¸ë£¹ ì´ë™
            if (endPage < totalPages) {
                paginationEl.appendChild(createBtn('...', endPage + 1));
                paginationEl.appendChild(createBtn('>', endPage + 1));
            }
        };

        window.changeQty = function (id, delta) {
            const qtyEl = document.getElementById(`qty-${id}`);
            let current = parseInt(qtyEl.innerText);
            const next = Math.max(1, current + delta);
            qtyEl.innerText = next;
        };

        itemsPerPageSelect.addEventListener('change', () => {
            currentPage = 1;
            itemsPerPage = parseInt(itemsPerPageSelect.value);
            renderBooks();
            renderPagination();
        });

        renderBooks();
        renderPagination();

        // ì¶”ì²œ ë„ì„œ ì¹´ë“œ
        const books = [
            { title: "ì´í™í‹°ë¸Œ ìë°”", author: "ì¡°ìŠˆì•„ ë¸”ë¡œí¬", price: 35000, thumbnail: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg" },
            { title: "ìë°”ì˜ ì •ì„", author: "ë‚¨ê¶ì„±", price: 30000, thumbnail: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg" },
            { title: "ìŠ¤í”„ë§ ë¶€íŠ¸ ì…ë¬¸", author: "ì´ë™ìš±", price: 32000, thumbnail: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg" },
            { title: "JPA ì™„ì „ ì •ë³µ", author: "ê¹€ì˜í•œ", price: 38000, thumbnail: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg" },
            { title: "ê°ì²´ì§€í–¥ì˜ ì‚¬ì‹¤ê³¼ ì˜¤í•´", author: "ì¡°ì˜í˜¸", price: 28000, thumbnail: "https://image.aladin.co.kr/product/35259/73/coversum/k142934245_1.jpg" }
        ];

        books.forEach(book => {
            const div = document.createElement('div');
            div.className = 'ink-card-white p-4 flex flex-col items-center text-center w-[200px]';

            div.innerHTML = `
        <div class="w-[120px] h-[180px] bg-gray-100 rounded-md overflow-hidden mb-3">
            <img
                src="${book.thumbnail}"
                alt="${book.title}"
                class="w-full h-full object-cover"
                onerror="this.style.display='none';"
            />
        </div>

        <h3 class="text-sm font-semibold text-gray-800 mb-1 truncate w-full">${book.title}</h3>
        <p class="text-xs text-gray-600 mb-1 truncate w-full">${book.author}</p>

        <div class="mb-3 flex flex-col items-center leading-tight">
            <span class="text-gray-400 line-through text-xs">â‚©${(book.price * 1.1).toLocaleString()}</span>
            <span class="text-sm text-gray-900 font-bold">â‚©${book.price.toLocaleString()}</span>
            <span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-md mt-1">10%</span>
        </div>
    `;
            recommendedBooks.appendChild(div);
        });

        // ë“œë¡­ë‹¤ìš´ ë”œë ˆì´
        document.querySelectorAll('.group, .group\\/korea, .group\\/global').forEach(group => {
            let timeout;
            const menu = group.querySelector('ul');
            if (!menu) return;

            group.addEventListener('mouseenter', () => {
                clearTimeout(timeout);
                menu.classList.remove('invisible', 'opacity-0', 'pointer-events-none');
                menu.classList.add('visible', 'opacity-100', 'pointer-events-auto');
            });

            group.addEventListener('mouseleave', () => {
                timeout = setTimeout(() => {
                    menu.classList.remove('visible', 'opacity-100', 'pointer-events-auto');
                    menu.classList.add('invisible', 'opacity-0', 'pointer-events-none');
                }, 100); //ì—¬ê¸°ì„œ ìˆ«ìë¥¼ ì¡°ì ˆí•˜ë©´ ë”œë ˆì´ ì‹œê°„ ì¡°ì ˆ ê°€ëŠ¥
            });
        });
    });
</script>
</body>
</html>