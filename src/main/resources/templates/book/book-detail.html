<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ink3</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/output.css}">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
<div th:replace="~{layout/fragments/header :: headerFragment}"></div>

<main class="container mx-auto px-4 py-8">
    <section class="text-gray-600 body-font overflow-hidden">
        <div class="bg-white rounded-lg shadow-md container px-5 py-24 mx-auto pl-16">
            <div class="lg:w-4/5 mx-auto flex flex-wrap">
                <div class="flex-shrink-0 w-full h-full md:w-1/3">
                    <img th:src="${book.thumbnailUrl}" alt="책 표지"
                         class="w-full h-auto object-cover rounded-md">
                </div>
                <div class="lg:w-1/2 w-full lg:pl-10 lg:py-6 mt-6 lg:mt-0">
                    <h1 class="text-gray-900 text-3xl title-font font-medium mb-1" th:text="${book.title}"></h1>

                    <div class="flex mb-4">
                        <span class="flex items-center">
                            <span class="text-gray-600">
                            <th:block th:each="author, iterStat : ${book.authorNames}">
                                <span th:text="${author}"></span><th:block th:if="${!iterStat.last}">, </th:block>
                            </th:block>
                        </span>
                            <span class="flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s" th:text="${book.publisherName}"></span>
                            <span class="flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s" th:text="${book.publishedAt}"></span>

                        </span>
                    </div>
                    <div class="flex mb-4">
                        <span class="flex items-center">
                            <!-- 별점 -->
                            <svg fill="currentColor" stroke="currentColor" stroke-linecap="round"
                                 stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-green-500"
                                 viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                            </svg>
                            <svg fill="currentColor" stroke="currentColor" stroke-linecap="round"
                                 stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-green-500"
                                 viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                            </svg>
                            <svg fill="currentColor" stroke="currentColor" stroke-linecap="round"
                                 stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-green-500"
                                 viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                            </svg>
                            <svg fill="currentColor" stroke="currentColor" stroke-linecap="round"
                                 stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-green-500"
                                 viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                            </svg>
                            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                 stroke-width="2" class="w-4 h-4 text-green-500" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                            </svg>
                            <!-- 리뷰 개수 -->
                            <span class="text-gray-600 ml-3">리뷰 10개</span>
                        </span>
                    </div>
                    <!-- 책 소개 -->
                    <p class="leading-relaxed" th:text="${book.description}"></p>
                    <br>
                    <!-- 카테고리 -->
                    <div class="flex mb-4">
                        <span class="flex items-center">
                            <span class="text-md text-gray-600 mb-1">카테고리</span>
                            <span class="text-gray-800 flex ml-3 pl-3 py-2 border-l-2 border-gray-200 flex-col">
                                <th:block th:each="category, iterStat : ${book.categoryNames}">
                                    <span th:text="${category}"></span>
                                    <br th:if="${!iterStat.last}" />
                                </th:block>
                            </span>
                        </span>
                    </div>

                    <!-- 태그 -->
                    <div class="flex mb-4">
                        <span class="flex items-center">
                            <span class="text-md text-gray-600 mb-1">태그</span>
                            <span class="text-gray-800 flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s">
                                <th:block th:each="tag, iterStat : ${book.tagNames}">
                                    <span th:text="${tag}"></span><th:block th:if="${!iterStat.last}">, </th:block>
                                </th:block>
                                <span th:unless="${#lists.size(book.tagNames) > 0}">
                                    태그 미설정
                                </span>
                            </span>
                        </span>
                    </div>

                    <!-- 포장 가능 여부 -->
                    <div class="flex mb-4">
                        <span class="flex items-center">
                            <span class="text-md text-gray-600 mb-1">포장 가능 여부</span>
                            <span class="text-gray-800 flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s"
                                  th:text="${book.isPackable ? '가능' : '불가능'}"></span>
                        </span>
                    </div>

                    <div th:if="${isLoggedIn}">
                        <form th:action="@{/carts}" method="post" class="flex gap-4 mt-auto">
                            <input type="hidden" name="bookId" th:value="1"/>

                            <div class="flex mb-4">
                            <span class="flex items-center">
                                <span class="text-md text-gray-600 mb-1">수량</span>
                                <span class="flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s"></span>
                                <input
                                        id="quantity"
                                        name="quantity"
                                        type="number"
                                        min="1"
                                        value="1"
                                        class="w-16 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </span>
                            </div>

                            <div class="flex gap-4 mt-0.5">
                                <button type="submit"
                                        class="ink-btn-primary bg-gray-300 text-gray-800 hover:bg-gray-400">
                                    장바구니에 넣기
                                </button>
                            </div>

                            <div class="flex gap-4 mt-0.5">
                                <a href="/books" class="ink-btn-primary bg-gray-300 text-gray-800 hover:bg-gray-400">목록으로</a>
                                <button class="rounded-full w-10 h-10 bg-gray-200 p-0 border-0 inline-flex items-center justify-center text-gray-500 ml-4">
                                    <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                         stroke-width="2"
                                         class="w-5 h-5" viewBox="0 0 24 24">
                                        <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div th:unless="${isLoggedIn}">
                        <form th:action="@{/guest-carts}" method="post" class="flex gap-4 mt-auto">
                            <input type="hidden" name="bookId" th:value="1"/>

                            <div class="flex mb-4">
                            <span class="flex items-center">
                                <span class="text-md text-gray-600 mb-1">수량</span>
                                <span class="flex ml-3 pl-3 py-2 border-l-2 border-gray-200 space-x-2s"></span>
                                <input
                                        id="quantity"
                                        name="quantity"
                                        type="number"
                                        min="1"
                                        value="1"
                                        class="w-16 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </span>
                            </div>

                            <div class="flex gap-4 mt-0.5">
                                <button type="submit"
                                        class="ink-btn-primary bg-gray-300 text-gray-800 hover:bg-gray-400">
                                    장바구니에 넣기
                                </button>
                            </div>

                            <div class="flex gap-4 mt-0.5">
                                <a href="/books" class="ink-btn-primary bg-gray-300 text-gray-800 hover:bg-gray-400">목록으로</a>
                                <button class="rounded-full w-10 h-10 bg-gray-200 p-0 border-0 inline-flex items-center justify-center text-gray-500 ml-4">
                                    <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                         stroke-width="2"
                                         class="w-5 h-5" viewBox="0 0 24 24">
                                        <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div>
                        <div class="flex items-baseline gap-2 mb-6">
                            <!-- 정가 -->
                            <span class="title-font font-medium text-gray-400 line-through text-lg" th:text="${book.originalPrice} + '원'"></span>

                            <!-- 할인가 -->
                            <span class="title-font font-medium text-2xl text-gray-900" th:text="${book.salePrice()} + '원'"></span>

                            <!-- 할인률 -->
                            <span class="title-font font-medium bg-red-100 text-red-600 text-sm font-bold px-2 py-1 rounded-md"
                                  th:if="${book.discountRate != null && book.discountRate > 0}"
                                  th:text="${book.discountRate} + '%'">
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-5xl mx-auto px-4 py-12 border-t border-gray-200 mt-12">
            <div class="md:flex md:gap-8">
                <!-- 섹션 제목 -->
                <div class="md:w-1/5 w-full mb-4 md:mb-0">
                    <h2 class="text-xl font-semibold text-gray-800">책소개</h2>
                </div>

                <!-- 소개 내용 -->
                <div class="md:w-4/5 w-full text-gray-700 leading-relaxed space-y-4" th:text="${book.description}"></div>
            </div>
        </div>

        <!-- 목차 섹션 -->
        <div class="max-w-5xl mx-auto px-4 py-12 border-t border-gray-200">
            <div class="md:flex md:gap-8">
                <!-- 섹션 제목 -->
                <div class="md:w-1/5 w-full mb-4 md:mb-0">
                    <h2 class="text-xl font-semibold text-gray-800">목차</h2>
                </div>

                <!-- 목차 내용 -->
                <div class="md:w-4/5 w-full text-gray-700 leading-relaxed space-y-4" th:text="${book.contents}"></div>
            </div>
        </div>

        <!-- 탭 버튼 -->
        <div class="max-w-5xl mx-auto px-4 mt-8 border-b border-gray-300 flex">
            <button id="infoTabBtn" class="px-4 py-2 font-semibold bg-gray-800 text-white">도서정보</button>
            <button id="reviewTabBtn" class="px-4 py-2 text-gray-700">리뷰/한줄평 <span class="text-xs">(25/3)</span>
            </button>
        </div>

        <!-- 도서정보 탭 내용 -->
        <div id="infoTabContent" class="max-w-5xl mx-auto px-4 py-12 border-t border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">책소개</h2>
            <div class="md:w-4/5 w-full text-gray-700 leading-relaxed space-y-4">
                <p>
                    아름다운 세계관과 개성 넘치는 캐릭터, 유려한 문체와 깊이 있는 감성으로 한국 판타지를 이끌어온 전민희 작가의 대표작 『룬의 아이들』 신작이 엘릭시르에서 출간된다. '룬의
                    아이들' 시리즈는 국내 판매량 총 160만 부를 넘은 밀리언셀러다. 뿐만 아니라 일본, 대만, 태국, 중국에 수출되어 국내외 판매량을 합치면 300만 부를 훌쩍 넘어 아시아
                    전역에서 가장 사랑받는 판타지라는 평가를 받고 있다.
                </p>
                <p>
                    『룬의 아이들 - 블러디드』는 『룬의 아이들 - 윈터러』에 이은 2부 『룬의 아이들 - 데모닉』이 완결된 지 11년 만의 신작이다. 1부 ‘룬의 아이들’ 시리즈 3부에
                    해당하는 이번 작품은 실종된 오빠에 얽힌 비밀과 맞서 분투하는 공녀를 중심으로 ‘블러디드’라는 힘에 관한 이야기를 다루고 있다.
                </p>
                <p>
                    『윈터러』와 『데모닉』의 세계관을 이어받은 3부 『블러디드』는 속도감 있는 전개와 새로운 캐릭터의 등장으로 첫 권부터 독자들의 호기심을 불러일으켜왔다. 소설의 클라이막스를
                    향해 달려가고 있는 이번 8권에서는 전권에 이어 샤를로트가 지닌 ‘블러디드’라는 힘, 바로 그 힘의 근원이 된 것으로 추정되는 샤를로트의 어머니의 정체, 그리고 ‘에투알’의
                    사명에 대한 더욱 깊고 거대한 비밀이 밝혀진다.
                </p>
                <p>
                    한편, 켈티카의 추억 어린 거리로 돌아온 막시민 또한 나름대로의 방법으로 진상에 다가가고 있었다. 그 과정에서 막시민은 그동안 외면해왔던 자신의 진심을 마주함과 동시에,
                    까맣게 모르고 있던 반짝이는 가능성을 발견한다. 마침내 결전의 장소로 향하는 샤를로트와 막시민, 두 사람은 아이언페이스와의 오래된 약속과 세상의 종말을 눈앞에 두고 과연
                    어떠한 선택을 하게 될까?
                </p>
            </div>

            <h2 class="text-xl font-semibold text-gray-800 mb-4">목차</h2>
            <div class="md:w-4/5 w-full text-gray-700 leading-relaxed space-y-4">
                <p>
                    15장 Origin
                    <br>사과나무의 땅 11
                    <br>지켜지는 자 41
                    <br>기나긴 죽음 74
                    <br>육신에만 담을 수 있는 것 98
                    <br>
                    <br>16장 Every Life
                    <br>한 인간의 무게 121
                    <br>아이언워크 144
                    <br>전통 있는 학교들의 입장 169
                    <br>신장개업 186
                    <br>돌아온 탐정 207
                    <br>근원 감응자 235
                    <br>다람쥐통 265
                    <br>휴업 286
                    <br>외교 특사 306
                </p>
            </div>
        </div>

        <!-- 리뷰 탭 내용 -->
        <div id="reviewTabContent" class="max-w-5xl mx-auto px-4 py-12 border-t border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">리뷰</h2>

            <!-- 리뷰 목록 -->
            <div class="space-y-6" th:each="review : ${reviews}">
                <div class="p-4 bg-white rounded shadow">
                    <div class="flex justify-between">
                        <p class="font-semibold text-gray-800" th:text="${review.title}">리뷰 제목</p>
                        <span class="text-sm text-gray-500"
                              th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</span>
                    </div>
                    <p class="text-sm text-yellow-500">
                        <span th:each="i : ${#numbers.sequence(1, review.rating)}">⭐</span>
                    </p>
                    <p class="text-gray-600 mt-1" th:text="${review.content}">리뷰 내용</p>

                    <!-- 리뷰 수정 폼 -->
                    <form th:action="@{/books/{bookId}/reviews/{reviewId}/update(bookId=${bookId}, reviewId=${review.id})}"
                          method="post" class="mt-2 space-y-2">
                        <input type="hidden" name="userId" th:value="${review.userId}">
                        <input type="hidden" name="orderBookId" th:value="${review.orderBookId}">
                        <input type="text" name="title" th:value="${review.title}" class="w-full border p-2 rounded"
                               required>
                        <textarea name="content" class="w-full border p-2 rounded" required
                                  th:text="${review.content}"></textarea>
                        <input type="number" name="rating" min="1" max="5" th:value="${review.rating}"
                               class="w-24 border p-1 rounded" required>
                        <button type="submit" class="text-sm text-blue-500 hover:underline">수정</button>
                    </form>

                    <!-- 리뷰 삭제 폼 -->
                    <form th:action="@{/books/{bookId}/reviews/{reviewId}/delete(bookId=${bookId}, reviewId=${review.id})}"
                          method="post">
                        <button type="submit" class="text-sm text-red-500 mt-2 hover:underline">삭제</button>
                    </form>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(reviews)}" class="text-gray-500">등록된 리뷰가 없습니다.</div>

            <!-- 리뷰 등록 폼 -->
            <form th:action="@{/books/{bookId}/reviews(bookId=${bookId})}" method="post" class="space-y-4 mt-8">
                <input type="hidden" name="userId" th:value="${userId}">
                <input type="hidden" name="orderBookId" th:value="${orderBookId}">
                <input type="text" name="title" placeholder="리뷰 제목" class="w-full border p-2 rounded" required>
                <textarea name="content" placeholder="리뷰 내용" class="w-full border p-2 rounded" required></textarea>
                <input type="number" name="rating" min="1" max="5" value="5" class="w-24 border p-1 rounded" required>
                <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded">리뷰 등록</button>
            </form>
        </div>
    </section>
</main>

<div th:replace="~{layout/fragments/footer :: footerFragment}"></div>

<script>
    const infoTabBtn = document.getElementById("infoTabBtn");
    const reviewTabBtn = document.getElementById("reviewTabBtn");
    const infoTabContent = document.getElementById("infoTabContent");
    const reviewTabContent = document.getElementById("reviewTabContent");

    infoTabBtn.addEventListener("click", () => {
        infoTabContent.classList.remove("hidden");
        reviewTabContent.classList.add("hidden");
        infoTabBtn.classList.add("bg-gray-800", "text-white");
        reviewTabBtn.classList.remove("bg-gray-800", "text-white");
        reviewTabBtn.classList.add("text-gray-700");
    });

    reviewTabBtn.addEventListener("click", () => {
        reviewTabContent.classList.remove("hidden");
        infoTabContent.classList.add("hidden");
        reviewTabBtn.classList.add("bg-gray-800", "text-white");
        infoTabBtn.classList.remove("bg-gray-800", "text-white");
        infoTabBtn.classList.add("text-gray-700");
    });
</script>
</body>
</html>
