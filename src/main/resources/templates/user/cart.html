<!DOCTYPE html>
<style>
    ul.space-y-4 > li {
        border-top: 1px solid #e5e7eb;
        padding-top: 1rem;
        margin-top: 1rem;
    }
    .max-w-lg {
        max-width: unset;
    }
</style>

<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ink3</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/output.css}">

    <style>

        body {

            font-family: 'Inter', sans-serif;

        }

    </style>

    <script>

        document.addEventListener('DOMContentLoaded', () => {

            const searchButton = document.getElementById('search-button');

            const searchInput = document.getElementById('search-input');


            searchButton.addEventListener('click', () => {

                searchInput.classList.toggle('hidden');

                searchInput.classList.toggle('w-0');

                searchInput.classList.toggle('opacity-0');

                searchInput.classList.toggle('w-48');

                searchInput.classList.toggle('opacity-100');

                searchInput.classList.toggle('pl-2');

            });

        });

    </script>

</head>

<body class="bg-gray-100">

<div th:replace="~{layout/fragments/header :: headerFragment}"></div>

<main class="container mx-auto px-4 py-8">

    <!--    <div class="ink-card-withe w-full p-12">-->
    <!--    </div>-->
    <section>
        <div class="mx-auto max-w-screen-xl px-4 py-8 sm:px-6 sm:py-12 lg:px-8">
            <div class="mx-auto max-w-4xl bg-white rounded-2xl shadow p-8">
                <div class="mx-auto max-w-3xl">
                    <header class="text-center">
                        <h1 class="text-xl font-bold text-gray-900 sm:text-3xl">장바구니</h1>
                    </header>

                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <!-- 왼쪽: 전체 선택 -->
                            <div>
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="selectAll" class="mr-2">
                                    <span class="text-ml">전체 선택</span>
                                </label>
                            </div>

                            <!-- 오른쪽: 버튼 그룹 -->
                            <div class="flex gap-2">
                                <button onclick="removeItems()"
                                        class="bg-ink-primary text-white px-4 py-2 text-sm rounded hover:bg-ink-primary">
                                    전체 삭제
                                </button>
                                <button onclick="removeSelectedItems()"
                                        class="bg-ink-primary text-white px-4 py-2 text-sm rounded hover:bg-ink-primary">
                                    선택 삭제
                                </button>
                            </div>
                        </div>

                        <ul class="space-y-4">
                            <li class="flex items-center gap-4">
                                <img
                                        src="https://images.unsplash.com/photo-1618354691373-d851c5c3a990?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=830&q=80"
                                        alt=""
                                        class="size-40 rounded-sm object-cover"
                                />

                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Basic Tee 6-Pack1</h3>

                                    <dl class="mt-0.5 space-y-px text-sm text-gray-600">
                                        <div>
                                            <dt class="inline">Size:</dt>
                                            <dd class="inline">XXS</dd>
                                        </div>

                                        <div>
                                            <dt class="inline">Color:</dt>
                                            <dd class="inline">White</dd>
                                        </div>

                                        <div>
                                            <dt class="inline font-medium">Price:</dt>
                                            <dd class="inline text-black">￦20,000</dd>
                                        </div>
                                    </dl>

                                    <div class="mt-2">
                                        <label for="couponSelect1"
                                               class="block text-sm font-medium text-gray-700"></label>
                                        <select
                                                id="couponSelect1"
                                                name="couponSelect1"
                                                class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
                                        >
                                            <option value="">쿠폰을 선택하세요</option>
                                            <option value="10off">생일 쿠폰(-5,000)</option>
                                            <option value="freedelivery">무료배송 쿠폰(-3,000)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flex flex-1 items-center justify-end gap-2">
                                    <div class="flex items-center gap-1">
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            −
                                        </button>
                                        <input
                                                type="number"
                                                id="Line1Qty"
                                                value="1"
                                                min="1"
                                                class="h-8 w-12 rounded-sm border-gray-200 text-center text-sm text-gray-700 [-moz-appearance:_textfield] focus:outline-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"
                                        />
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            ＋
                                        </button>
                                    </div>

                                    <button class="text-gray-600 transition hover:text-red-600">
                                        <span class="sr-only">Remove item</span>

                                        <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke-width="1.5"
                                                stroke="currentColor"
                                                class="size-5"
                                        >
                                            <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </li>

                            <li class="flex items-center gap-4">
                                <img
                                        src="https://images.unsplash.com/photo-1618354691373-d851c5c3a990?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=830&q=80"
                                        alt=""
                                        class="size-40 rounded-sm object-cover"
                                />

                                <div>
                                    <h3 class="text-lg font-semibold">Basic Tee 6-Pack2</h3>

                                    <dl class="mt-0.5 space-y-px text-sm text-gray-600">
                                        <div>
                                            <dt class="inline">Size:</dt>
                                            <dd class="inline">XXS</dd>
                                        </div>

                                        <div>
                                            <dt class="inline">Color:</dt>
                                            <dd class="inline">White</dd>
                                        </div>

                                        <div>
                                            <dt class="inline font-medium">Price:</dt>
                                            <dd class="inline text-black">￦20,000</dd>
                                        </div>
                                    </dl>

                                    <div class="mt-2">
                                        <label for="couponSelect2"
                                               class="block text-sm font-medium text-gray-700"></label>
                                        <select
                                                id="couponSelect2"
                                                name="couponSelect2"
                                                class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
                                        >
                                            <option value="">쿠폰을 선택하세요</option>
                                            <option value="10off">생일 쿠폰(-5,000)</option>
                                            <option value="freedelivery">무료배송 쿠폰(-3,000)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flex flex-1 items-center justify-end gap-2">
                                    <div class="flex items-center gap-1">
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            −
                                        </button>
                                        <input
                                                type="number"
                                                id="Line2Qty"
                                                value="1"
                                                min="1"
                                                class="h-8 w-12 rounded-sm border-gray-200 text-center text-sm text-gray-700 [-moz-appearance:_textfield] focus:outline-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"
                                        />
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            ＋
                                        </button>
                                    </div>

                                    <button class="text-gray-600 transition hover:text-red-600">
                                        <span class="sr-only">Remove item</span>

                                        <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke-width="1.5"
                                                stroke="currentColor"
                                                class="size-5"
                                        >
                                            <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </li>

                            <li class="flex items-center gap-4">
                                <img
                                        src="https://images.unsplash.com/photo-1618354691373-d851c5c3a990?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=830&q=80"
                                        alt=""
                                        class="size-40 rounded-sm object-cover"
                                />

                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Basic Tee 6-Pack3</h3>

                                    <dl class="mt-0.5 space-y-px text-sm text-gray-600">
                                        <div>
                                            <dt class="inline">Size:</dt>
                                            <dd class="inline">XXS</dd>
                                        </div>

                                        <div>
                                            <dt class="inline">Color:</dt>
                                            <dd class="inline">White</dd>
                                        </div>

                                        <div>
                                            <dt class="inline font-medium">Price:</dt>
                                            <dd class="inline text-black">￦20,000</dd>
                                        </div>
                                    </dl>

                                    <div class="mt-2">
                                        <label for="couponSelect3"
                                               class="block text-sm font-medium text-gray-700"></label>
                                        <select
                                                id="couponSelect3"
                                                name="couponSelect3"
                                                class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
                                        >
                                            <option value="">쿠폰을 선택하세요</option>
                                            <option value="10off">생일 쿠폰(-5,000)</option>
                                            <option value="freedelivery">무료배송 쿠폰(-3,000)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flex flex-1 items-center justify-end gap-2">
                                    <div class="flex items-center gap-1">
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            −
                                        </button>
                                        <input
                                                type="number"
                                                id="Line3Qty"
                                                value="1"
                                                min="1"
                                                class="h-8 w-12 rounded-sm border-gray-200 text-center text-sm text-gray-700 [-moz-appearance:_textfield] focus:outline-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"
                                        />
                                        <button type="button"
                                                class="size-8 leading-8 text-gray-600 border rounded hover:bg-gray-100 transition">
                                            ＋
                                        </button>
                                    </div>

                                    <button class="text-gray-600 transition hover:text-red-600">
                                        <span class="sr-only">Remove item</span>

                                        <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke-width="1.5"
                                                stroke="currentColor"
                                                class="size-5"
                                        >
                                            <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </li>
                        </ul>

                        <div class="mt-8 flex justify-end border-t border-gray-100 pt-8">
                            <div class="w-screen max-w-lg space-y-4">
                                <dl class="space-y-0.5 text-ml text-gray-700">
                                    <div class="flex justify-between items-center">
                                        <dt class="text-left w-full">주문 금액</dt>
                                        <dd class="text-right w-full">￦60,000</dd>
                                    </div>

                                    <div class="flex justify-between items-center">
                                        <dt class="text-left w-full">할인 금액</dt>
                                        <dd class="text-right w-full">-￦5,000</dd>
                                    </div>

                                    <div class="flex justify-between items-center !text-base font-medium">
                                        <dt class="text-left w-full">총 주문 금액</dt>
                                        <dd class="text-right w-full">￦55,000</dd>
                                    </div>
                                </dl>

                                <div class="flex justify-end">
              <span
                      class="inline-flex items-center justify-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-indigo-700"
              >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="-ms-1 me-1.5 size-4"
                >
                  <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 010 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 010-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375z"
                  />
                </svg>

                <p class="text-xs whitespace-nowrap">쿠폰 적용 완료</p>
              </span>
                                </div>

                                <div class="flex justify-end">
                                    <a
                                            href="#"
                                            class="ink-btn-primary bg-gray-700 px-5 py-3 text-sm text-gray-100 transition hover:bg-gray-600"
                                    >
                                        주문하기
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<div th:replace="~{layout/fragments/footer :: footerFragment}"></div>

</body>

</html>

<script>
    const COOKIE_NAME = 'guest_cart';

    function getGuestCart() {
        const match = document.cookie.match(new RegExp('(^| )' + COOKIE_NAME + '=([^;]+)'));
        return match ? JSON.parse(decodeURIComponent(match[2])) : [];
    }

    function saveGuestCart(cart) {
        const encoded = encodeURIComponent(JSON.stringify(cart));
        document.cookie = `${COOKIE_NAME}=${encoded}; path=/; max-age=${60 * 60 * 24 * 3}`; // 3일
    }

    function addToGuestCart(bookId, quantity) {
        const cart = getGuestCart();
        const item = cart.find(c => c.bookId === bookId);
        if (item) {
            item.quantity += quantity;
        } else {
            cart.push({bookId, quantity});
        }
        saveGuestCart(cart);
    }

    function removeFromGuestCart(bookId) {
        let cart = getGuestCart();
        cart = cart.filter(c => c.bookId !== bookId);
        saveGuestCart(cart);
    }

    function removeItems() {
        const checkedIds = Array.from(document.querySelectorAll('.guest-cart-checkbox:checked'))
            .map(cb => Number(cb.value));

        if (checkedIds.length === 0) return;

        const cart = getGuestCart().filter(item => !checkedIds.includes(item.bookId));
        saveGuestCart(cart);
        location.reload();
    }

    function removeSelectedItems() {
        const checkedIds = Array.from(document.querySelectorAll('.guest-cart-checkbox:checked'))
            .map(cb => Number(cb.value));

        if (checkedIds.length === 0) return;

        const cart = getGuestCart().filter(item => !checkedIds.includes(item.bookId));
        saveGuestCart(cart);
        location.reload();
    }

    document.addEventListener('DOMContentLoaded', async () => {
        const guestCart = getGuestCart();
        if (guestCart.length === 0) return;

        const response = await fetch("http://localhost:8080/carts/guest", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(guestCart)
        });

        const items = await response.json();
        renderCartItems(items); // 이 함수에서 HTML 동적 생성
    });

    function renderCartItems(items) {
        const ul = document.querySelector('ul.space-y-4');
        ul.innerHTML = '';

        items.forEach(item => {
            const li = document.createElement('li');
            li.className = 'flex items-center gap-4';

            li.innerHTML = `
            <input type="checkbox" class="guest-cart-checkbox" value="${item.bookId}">
            <img src="${item.thumbnailUrl}" alt="${item.title}" class="size-40 rounded-sm object-cover" />
            <div>
                <h3 class="text-lg font-semibold text-gray-900">${item.title}</h3>
                <dl class="mt-0.5 space-y-px text-sm text-gray-600">
                    <div><dt class="inline">가격:</dt> <dd class="inline text-black">₩${item.price.toLocaleString()}</dd>
                        <span class="inline-flex items-center ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-indigo-500">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 8a3 3 0 10-6 0m6 3a2 2 0 11-4 0m-2-3a4 4 0 11-8 0c0 1.36.689 2.47 1.724 3.304A6.017 6.017 0 009.77 9.1c.598-.199 1.153-.326 1.63-.326a2 2 0 002.062 0c.623.217 1.165.504 1.65.824 1.796 1.477 3.2 3.095 3.2 5.354 0 2.259-1.404 3.877-3.2 5.354-1.796 1.477-3.2 3.095-3.2 5.354 0 2.259 1.404 3.877 3.2 5.354 1.796 1.477 3.2 3.095 3.2 5.354m-10.082 1.8a7 7 0 01-6.434-6.434c-.29-.037-.586-.059-.88-.059h-.008c-.667 0-1.217.54-1.217 1.207 0 .308.115.607.337.852a7 7 0 006.434 6.434c.29.037.586.059.88.059h.008c.667 0 1.217-.54 1.217-1.207 0-.308-.115-.607-.337-.852z" />
                            </svg>
                            <span>+${item.pointAmount.toLocaleString()}</span>
                        </span>
                    </div>
                    <div><dt class="inline">수량:</dt> <dd class="inline text-black">${item.quantity}</dd></div>
                </dl>
            </div>
        `;

            ul.appendChild(li);
        });

        const selectAll = document.getElementById('selectAll');
        if (selectAll) {
            selectAll.checked = false;
            selectAll.addEventListener('change', () => {
                document.querySelectorAll('.guest-cart-checkbox').forEach(cb => cb.checked = selectAll.checked);
            });
        }
    }
</script>
