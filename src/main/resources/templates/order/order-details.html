<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ink3</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/output.css(v=${#dates.createNow().getTime()})}">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
<div th:replace="~{layout/fragments/header :: headerFragment}"></div>
<main class="mx-auto max-w-[900px] px-4 py-10">

    <!-- 주문 상태 진행 -->
    <div class="mb-10">
        <!-- 진행 바 -->
        <div class="overflow-hidden rounded-full bg-gray-200 h-2 mb-4"
             th:with="barWidthClass=
         ${order.status.name() == 'CONFIRMED'} ? 'w-1/3' :
         (${order.status.name() == 'DELIVERING'} ? 'w-2/3' :
         (${order.status.name() == 'DELIVERED'} ? 'w-full' : ''))">
            <div class="h-2 bg-blue-500 transition-all duration-500"
                 th:classappend="${barWidthClass}">
            </div>
        </div>

        <!-- 상태 텍스트 + 아이콘 -->
        <ol class="grid grid-cols-3 text-sm font-semibold text-gray-600 text-center">
            <li th:classappend="${order.status.name() == 'CONFIRMED'} ? ' text-blue-600' : ' text-gray-400'">
                <div class="flex flex-col items-center gap-1">
                    <svg class="size-7" xmlns="http://www.w3.org/2000/svg" fill="none"
                         viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M12 6v6l4 2"/>
                    </svg>
                    대기
                </div>
            </li>

            <li th:classappend="${order.status.name() == 'DELIVERING'} ? ' text-blue-600' : ' text-gray-400'">
                <div class="flex flex-col items-center gap-1">
                    <svg class="size-7" xmlns="http://www.w3.org/2000/svg" fill="none"
                         viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3 10h18M9 16h6"/>
                    </svg>
                    배송중
                </div>
            </li>

            <li th:classappend="${order.status.name() == 'DELIVERED'} ? ' text-blue-600' : ' text-gray-400'">
                <div class="flex flex-col items-center gap-1">
                    <svg class="size-7" xmlns="http://www.w3.org/2000/svg" fill="none"
                         viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M5 13l4 4L19 7"/>
                    </svg>
                    배송완료
                </div>
            </li>
        </ol>

    </div>

    <section class="bg-white rounded-2xl shadow-md p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-6">주문 상세</h2>

        <!-- 주문 정보 -->
        <h2 class="text-xl font-semibold mt-4 mb-3">주문 정보</h2>
        <table class="w-full text-sm text-left text-gray-700 border border-gray-200 mb-6">
            <tbody class="divide-y divide-gray-200">
            <tr>
                <th class="bg-gray-50 px-6 py-3 w-1/4">주문번호</th>
                <td class="px-6 py-3" th:text="${order.orderUUID}"></td>
                <th class="bg-gray-50 px-6 py-3 w-1/4">주문일자</th>
                <td class="px-6 py-3" th:text="${#temporals.format(order.orderedAt, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            <tr>
                <th class="bg-gray-50 px-6 py-3">주문자</th>
                <td class="px-6 py-3" th:text="${order.ordererName}"></td>
                <th class="bg-gray-50 px-6 py-3">연락처</th>
                <td class="px-6 py-3" th:text="${order.ordererPhone}"></td>
            </tr>
            <tr>
                <th class="bg-gray-50 px-6 py-3">주문 상태</th>
                <td class="px-6 py-3" th:text="${order.status.label}"></td>
                <td colspan="2"></td>
            </tr>
            </tbody>
        </table>

        <!-- 배송 정보 -->
        <h2 class="text-xl font-semibold mt-8 mb-3">배송 정보</h2>
        <table class="w-full text-sm text-left text-gray-700 border border-gray-200 mb-6">
            <tbody class="divide-y divide-gray-200">
            <tr>
                <th class="bg-gray-50 px-6 py-3 w-1/4">수령인</th>
                <td class="px-6 py-3" th:text="${shipment?.recipientName ?: '배송 정보 없음'}"></td>
                <th class="bg-gray-50 px-6 py-3">연락처</th>
                <td class="px-6 py-3" th:text="${shipment?.recipientPhone ?: ''}"></td>
            </tr>
            <tr>
                <th class="bg-gray-50 px-6 py-3">주소</th>
                <td colspan="3" class="px-6 py-3"
                    th:if="${shipment != null}"
                    th:text="|(${shipment.postalCode}) ${shipment.defaultAddress} ${shipment.detailAddress} ${shipment.extraAddress}|">
                </td>
                <td colspan="3" class="px-6 py-3" th:unless="${shipment != null}">
                    배송 정보 없음
                </td>
            </tr>
            <tr>
                <th class="bg-gray-50 px-6 py-3">희망 배송일</th>
                <td class="px-6 py-3" th:text="${shipment?.preferredDeliveryDate ?: '미지정'}"></td>
                <th class="bg-gray-50 px-6 py-3">배송 상태</th>
                <td class="px-6 py-3" th:text="${shipment?.shippingCode ?: '없음'}"></td>
            </tr>
            <tr>
                <th class="bg-gray-50 px-6 py-3">배송비</th>
                <td class="px-6 py-3" th:text="${shipment?.shippingFee} + '원'"></td>
                <td colspan="2"></td>
            </tr>
            </tbody>
        </table>

        <!-- 주문 상품 목록 -->
        <h3 class="text-xl font-semibold mt-8 mb-3">주문 상품</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-left text-gray-700 border border-gray-200">
                <thead class="bg-gray-50 text-gray-800">
                <tr>
                    <th class="px-4 py-3">도서명</th>
                    <th class="px-4 py-3">수량</th>
                    <th class="px-4 py-3">단가</th>
                    <th class="px-4 py-3">포장</th>
                    <th class="px-4 py-3">쿠폰</th>
                    <th class="px-4 py-3">총액</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                <tr th:each="book : ${orderBookList.content}">
                    <td class="px-4 py-3" th:text="${book.bookName}">도서명</td>
                    <td class="px-4 py-3" th:text="${book.quantity}">1</td>
                    <td class="px-4 py-3" th:text="${book.bookSalePrice} + '원'">15,000원</td>
                    <td class="px-4 py-3" th:text="${book.packagingName} + ' (' + ${book.packagingPrice} + '원)'"></td>
                    <td class="px-4 py-3" th:text="${book.couponName != null ? book.couponName : '-'}"></td>
                    <td class="px-4 py-3" th:text="${book.price * book.quantity + book.packagingPrice} + '원'">합계</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>




    <section class="bg-white rounded-2xl shadow-md p-6 mb-6">
        <h2 class="text-2xl font-semibold mb-4">결제 내역</h2>

        <div class="mb-4 space-y-1 text-sm text-gray-800">
            <div class="flex justify-between">
                <span>주문번호</span>
                <span th:text="${paymentResponse.orderId}">123456</span>
            </div>
            <div class="flex justify-between">
                <span>결제수단</span>
                <span th:text="${paymentResponse.paymentType}">TOSS</span>
            </div>
            <div class="flex justify-between">
                <span>요청일시</span>
                <span th:text="${#temporals.format(paymentResponse.requestedAt, 'yyyy-MM-dd HH:mm')}">2025-05-31 09:14</span>
            </div>
            <div class="flex justify-between">
                <span>승인일시</span>
                <span th:text="${#temporals.format(paymentResponse.approvedAt, 'yyyy-MM-dd HH:mm')}">2025-05-31 09:15</span>
            </div>
        </div>

        <div class="border-t border-dashed border-gray-400 my-2"></div>

        <div class="mb-4 space-y-1 text-sm">
            <div class="flex justify-between">
                <span>상품금액</span>
                <span th:text="${#numbers.formatInteger(paymentResponse.paymentAmount + paymentResponse.discountAmount + paymentResponse.usedPointAmount, 0)} + '원'">30,000원</span>
            </div>
            <div class="flex justify-between text-red-600">
                <span>할인</span>
                <span th:text="'-' + ${#numbers.formatInteger(paymentResponse.discountAmount, 0)} + '원'">-2,000원</span>
            </div>
            <div class="flex justify-between text-blue-600">
                <span>포인트 사용</span>
                <span th:text="'-' + ${#numbers.formatInteger(paymentResponse.usedPointAmount, 0)} + 'P'">-500P</span>
            </div>
        </div>

        <div class="border-t border-dashed border-gray-400 my-2"></div>

        <div class="flex justify-between font-bold text-base mt-2">
            <span>총 결제금액</span>
            <span th:text="${#numbers.formatInteger(paymentResponse.paymentAmount, 0)} + '원'">29,000원</span>
        </div>
    </section>


    <!-- 버튼 -->
    <div class="flex flex-col sm:flex-row gap-4 justify-end">
        <button type="button"
                class="px-6 py-2 text-white bg-red-500 rounded hover:bg-red-600 transition"
                th:if="${order.status.name() == 'CONFIRMED'}">
            주문 취소 요청
        </button>
        <button type="button"
                class="px-6 py-2 text-white bg-red-500 rounded hover:bg-red-600 transition"
                th:if="${order.status.name() == 'DELIVERED'}">
            반품 신청
        </button>
    </div>

</main>

<div th:replace="~{layout/fragments/footer :: footerFragment}"></div>
</body>
</html>
